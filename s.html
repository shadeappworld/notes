<div class="circle-popup">
  <div class="chat-icon" id="chat-icon">Open Shade AI</div>
  <div class="popup-content">
    <iframe id="popup-iframe" src="https://shademusic.vercel.app" allowfullscreen="true" draggable="true" allow="camera; microphone"></iframe>
  </div>
</div>

<script>
  // Get the necessary DOM elements
  var circlePopup = document.querySelector('.circle-popup');
  var popupContent = document.querySelector('.popup-content');
  var chatIcon = document.getElementById('chat-icon');
  var iframe = document.getElementById('popup-iframe');

  // Function to toggle the popup
  function togglePopup() {
    popupContent.style.display = popupContent.style.display === 'block' ? 'none' : 'block';
  }

  // Function to update the button text based on iframe content
  function updateButtonText() {
    // Example logic to check if iframe is playing music or using the microphone
    // This is a placeholder and should be replaced with actual logic to detect the iframe state
    var isPlayingMusic = false; // Replace with actual check
    var isUsingMicrophone = false; // Replace with actual check
    var songName = "Song Name"; // Replace with actual song name

    if (isPlayingMusic) {
      chatIcon.textContent = `Music Playing: ${songName}`;
    } else if (isUsingMicrophone) {
      chatIcon.textContent = "Calling AI";
    } else {
      chatIcon.textContent = "Open Shade AI";
    }
  }

  // Add event listeners to the elements
  circlePopup.addEventListener('click', togglePopup);
  iframe.addEventListener('load', updateButtonText); // Update button text when iframe loads

  // Example: Update button text every second (replace with actual logic)
  setInterval(updateButtonText, 1000);
</script>

<style>
  .circle-popup {
    position: fixed;
    bottom: 0px;
    left: 0px;
    width: 100%;
    height: 5%;
    border-radius: 1px;
    background-color: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 9999;
  }

  .chat-icon {
    position: fixed;
    bottom: 0px;
    left: 0px;
    width: 100%;
    height: 5%;
    border-radius: 1px;
    background-color: transparent;
    backdrop-filter: blur(3px);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 9999;
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.01);
  }

  .chat-icon::after {
    position: absolute;
    content: "";
    bottom: 15px;
    left: 0;
    right: 0;
    z-index: -1;
    height: 100%;
    width: 100%;
    transform: scale(1.4) translateZ(0);
    filter: blur(25px);
    background: linear-gradient(to left, #ff5770, #e4428d, #c42da8, #9e16c3, #6501de, #9e16c3, #c42da8, #e4428d, #ff5770);
    background-size: 200% 200%;
    -webkit-animation: animateGlow 1.25s linear infinite;
    animation: animateGlow 1.25s linear infinite;
  }

  @-webkit-keyframes animateGlow {
    0% {
      background-position: 200% 200%;
    }
    100% {
      background-position: 200% 200%;
    }
  }

  @keyframes animateGlow {
    0% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 200% 50%;
    }
  }

  .popup-content {
    top: 35%;
    border-radius: 4%;
    z-index: 999;
    display: none; /* Initially hidden */
    position: fixed;
    left: 10%;
    width: 80%;
    height: 50%;
    background-color: grey;
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .close-btn {
    position: fixed;
    bottom: 0px;
    left: 0px;
    width: 100%;
    height: 40px;
    border-radius: 0px;
    background-color: #264d29;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 9999;
  }

  iframe {
    width: 100%;
    height: 100%;
    border-radius: 0%;
  }
</style>
